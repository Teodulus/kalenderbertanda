<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Note 2026</title>
    <style>
        /* GAYA TAMPILAN (CSS) */
        body { font-family: sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; padding-top: 50px; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 400px; }
        h2 { text-align: center; color: #333; }

        /* Form Login */
        #login-form { display: flex; flex-direction: column; gap: 10px; }
        input { padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        button { padding: 10px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background-color: #218838; }
        .error { color: red; text-align: center; font-size: 0.9em; display: none; }

        /* Kalender */
        #calendar-view { display: none; } /* Sembunyi dulu sebelum login */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .day { padding: 10px; background: #eee; border-radius: 5px; cursor: pointer; }
        .day:hover { background: #ddd; }
        .has-note { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .logout-btn { background-color: #dc3545; font-size: 0.8em; }

        /* Modal Catatan */
        #note-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 15% auto; padding: 20px; width: 300px; border-radius: 5px; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-view">
        <h2>üîê Silakan Login</h2>
        <div id="login-form">
            <input type="text" id="username" placeholder="Username (contoh: budi)">
            <input type="password" id="password" placeholder="Password">
            <p id="error-msg" class="error">Login Gagal! Cek username/password.</p>
            <button onclick="login()">MASUK</button>
        </div>
    </div>

    <div id="calendar-view">
        <div class="header">
            <h3 id="month-year">Januari 2026</h3>
            <button class="logout-btn" onclick="logout()">Keluar</button>
        </div>
        <div class="grid" id="days-grid">
        </div>
    </div>
</div>

<div id="note-modal">
    <div class="modal-content">
        <h3>Catatan Tanggal <span id="selected-date"></span></h3>
        <textarea id="note-content" placeholder="Tulis catatan..."></textarea>
        <button onclick="saveNote()">Simpan</button>
        <button onclick="closeModal()" style="background:#6c757d; margin-top:5px;">Batal</button>
    </div>
</div>

<script>
    // LOGIKA PROGRAM (JAVASCRIPT)
    let authHeader = ''; // Simpan password di sini
    let currentYear = 2026;
    let currentMonth = 0; // 0 = Januari

    async function login() {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;
        // Bikin "Kunci" Basic Auth
        authHeader = 'Basic ' + btoa(u + ":" + p);

        // Coba tes koneksi ke API
        try {
            const response = await fetch('/api/notes', { headers: { 'Authorization': authHeader } });

            if (response.ok) {
                // Kalau sukses, tampilkan kalender
                document.getElementById('login-view').style.display = 'none';
                document.getElementById('calendar-view').style.display = 'block';
                loadCalendar();
            } else {
                showError();
            }
        } catch (e) {
            showError();
        }
    }

    function showError() {
        document.getElementById('error-msg').style.display = 'block';
    }

    function logout() {
        location.reload(); // Refresh halaman
    }

    async function loadCalendar() {
        const grid = document.getElementById('days-grid');
        grid.innerHTML = ''; // Bersihkan lama

        // Ambil data catatan dari server
        const res = await fetch('/api/notes', { headers: { 'Authorization': authHeader } });
        const notes = await res.json();

        // Logika Kalender Sederhana (Januari 2026)
        const daysInMonth = 31;

        for (let i = 1; i <= daysInMonth; i++) {
            const div = document.createElement('div');
            div.className = 'day';
            div.innerText = i;

            // Cek apakah tanggal ini punya catatan?
            // Format tanggal di database: YYYY-MM-DD
            const dateStr = `2026-01-${String(i).padStart(2, '0')}`;
            const note = notes.find(n => n.date === dateStr);

            if (note) {
                div.classList.add('has-note'); // Warnai hijau
                div.title = note.content; // Hover muncul teks
            }

            div.onclick = () => openModal(dateStr, note ? note.content : '');
            grid.appendChild(div);
        }
    }

    // --- Logika Catatan ---
    let activeDate = '';
    function openModal(date, content) {
        activeDate = date;
        document.getElementById('selected-date').innerText = date;
        document.getElementById('note-content').value = content;
        document.getElementById('note-modal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('note-modal').style.display = 'none';
    }

    async function saveNote() {
        const content = document.getElementById('note-content').value;

        await fetch('/api/notes', {
            method: 'POST',
            headers: {
                'Authorization': authHeader,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ date: activeDate, content: content })
        });

        closeModal();
        loadCalendar(); // Refresh biar warnanya berubah
    }
</script>
</body>
</html>